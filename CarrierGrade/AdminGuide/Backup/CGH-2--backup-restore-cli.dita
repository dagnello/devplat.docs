<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic10581">
  <title>HP Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 2.0 Beta: Backup and Restore
    CLI</title>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HP Helion OpenStack Carreir Grade 1.1"/>
      <othermeta name="role" content="Storage Administrator"/>
      <othermeta name="role" content="Storage Architect"/>
      <othermeta name="role" content="Michael B"/>
      <othermeta name="product-version1" content="HP Helion OpenStack Carreir Grade 1.1"/>
    </metadata>
  </prolog>
  <body>
    <!-- https://wiki.hpcloud.net/pages/viewpage.action?pageId=53513771 -->
    <p><!-- Here is the wiki link for Attis. <xref href="https://rndwiki.corp.hpecorp.net/confluence/pages/viewpage.action?pageId=946944841" format="html" scope="external">https://rndwiki.corp.hpecorp.net/confluence/pages/viewpage.action?pageId=946944841</xref> 
The high level design needs to be adjusted to more suite with CG(It is reflecting CS in some areas)I will soon update it. 
But the CLI, REST API etc should all be same --></p>
    <p>HP Helion OpenStack Carrier Grade includes a backup and restore application called Attis
      which you can use to backup and restore essential system files and components of the non-KVM
      cloud. Attis is automatically installed on each of the controller nodes in the non-KVM region.
      Attis uses a command line interface.</p>
    <p>The following document describes the full Attis CLI for backing up and restoring. You can
      also use the built-in Attis help system by entering <codeph>attis help</codeph> before any
      command when working with the CLI. For example:</p>
    <p>
      <codeblock>attis help storage</codeblock>
    </p>
    <section>
      <title>IMPORTANT: Attis Administrator Responsibilites for Protecting Credentials</title>
      <p> Attis performs encrypted backup and restore of system data. The key for encryption and
        decryption is stored in the Attis configuration file on each controller node. If this key is
        lost, your backups can not be restored. Consider storing the backup encryption key
        separately from your cloud infrastructure, in addition to the copy stored on each controller
        node.</p>
      <p> Be aware that keys and passwords for other OpenStack services are stored in configuration
        files on cloud infrastructure nodes, protected by filesystem controls. Protect servers from
        authorized access to protect against exposure of credentials in configuration files. Attis
        backups contain copies of these credentials as well, protected from snooping via backup
        encryption, but exposure of the Attis backup key could result in unauthorized exposure of
        credentials stored in backups.</p>
    </section>
    <section/>
    <p><b>Synopsis</b></p>
    <p>
      <codeblock>attis [--version] [-v] [--log-file LOG_FILE] [-q] [-h] [--debug]</codeblock>
    </p>
    <p><b>Optional arguments</b></p>
    <p>
      <ul id="ul_ivp_wr3_pt">
        <li><codeph>--version</codeph> Shows program's version number and exits. </li>
        <li><codeph>-v, --verbose</codeph> Increases verbosity of output. Can be repeated. </li>
        <li><codeph>--log-file LOG_FILE</codeph> Specifies a file to log output. Disabled by
          default. </li>
        <li><codeph>-q, --quiet</codeph> Suppresses output except warnings and errors. </li>
        <li><codeph>-h, --help</codeph> Shows help message and exits. </li>
        <li><codeph>--debug</codeph> Shows tracebacks on errors.</li>
      </ul>
    </p>
    <p><b>Commands</b></p>
    <p>
      <ul id="ul_f45_xr3_pt">
        <li><codeph>backup</codeph> -- Triggers the backup service. </li>
        <li><codeph>backuplog</codeph> -- Shows backup logs. </li>
        <li><codeph>complete</codeph> -- Prints bash completion command </li>
        <li><codeph>config</codeph> -- Shows stored configuration for Attis service. </li>
        <li><codeph>help</codeph> -- Shows detailed help for another command. </li>
        <li><codeph>job</codeph> -- Shows previous Attis backup/restore jobs. </li>
        <li><codeph>queue</codeph> -- Shows dispatcher queues. </li>
        <li><codeph>recover</codeph> -- Triggers Attis recover service. </li>
        <li><codeph>report</codeph> -- Shows recovery reports. </li>
        <li><codeph>restart</codeph> -- Triggers the Attis restart service. </li>
        <li><codeph>restore</codeph> -- Triggers the Attis restore service. </li>
        <li><codeph>storage</codeph> -- Shows storage configuration for the Attis service. </li>
        <li><codeph>task</codeph> -- Shows previous Attis backup/restore tasks. </li>
      </ul>
    </p>
    <section>
      <title>Important commands</title>
    </section>
    <p><b>Back up</b></p>
    <p>The following command triggers the backup service. Use <codeph>attis help backup</codeph> for
      more information.</p>
    <codeblock>$attis help backup usage: attis backup [-h] [--confid CONFIG_ID] [--os-tenant-name TENANT_NAME] [--os-username USERNAME] [--os-password PASSWORD] [--os-auth-url AUTH_URL]</codeblock>
    <p><b>Arguments:</b>
    </p>
    <p>
      <ul id="ul_t3w_x53_pt">
        <li><codeph>--confid CONFIG_ID</codeph> Backup using configuration with id. Refer to attis
          config. </li>
        <li><codeph>--confpath CONFIG_PATH</codeph> Backup using configuration from path. Default
          config location: <codeph>/etc/attis/config_template</codeph>. </li>
        <li><codeph>--os-tenant-name TENANT_NAME</codeph> Specifies the project (tenant) name of the
          user used to execute the back up. </li>
        <li><codeph>--os-username USERNAME</codeph> Specifies the user name to execute the back up </li>
        <li><codeph>--os-password PASSWORD</codeph> Specifies the password of the user used to
          execute the back up </li>
        <li><codeph>--os-auth-url AUTH_URL</codeph> Specifies the Keystone authentication URL.</li>
        <li><codeph>--backup_type BACKUP_TYPE</codeph> Backup type is full or incremental. Default
          is full backup.</li>
      </ul>
    </p>
    <p><b>Restore</b></p>
    <p>The following command triggers a restore. Use <codeph>attis help restore</codeph> for more
      information.</p>
    <codeblock>attis restore [-h] [--confid CONFIG_ID] [--backup-id BACKUP_ID] [--os-tenant-name TENANT_NAME] [--os-username USERNAME] [--os-password PASSWORD] [--os-auth-url AUTH_URL]</codeblock>
    <p><b>Arguments</b></p>
    <p>
      <ul id="ul_rrj_fw3_pt">
        <li><codeph>--confid CONFIG_ID</codeph> -- Restores using configuration with id. Refer to
          attis config </li>
        <li><codeph>--config-path CONFIG_PATH</codeph> -- Restores using configuration from path.
          Example config location:<codeph>
            /opt/stack/attis-api/etc/attis/config_template/cloudcontrollerappliancedbrestore_scp.json</codeph>
        </li>
        <li><codeph>--backup-id BACKUP_ID</codeph> -- Specifies the ID of the backup to use with the
          restore. </li>
        <li><codeph>--os-tenant-name TENANT_NAME</codeph> -- Specifies the project (tenant) name of
          the user used to execute the restore. </li>
        <li><codeph>--os-username USERNAME</codeph> -- Specifies the user name to execute the
          restore </li>
        <li><codeph>--os-password PASSWORD</codeph> -- Specifies the password of the user used to
          execute the restore </li>
        <li><codeph>--os-auth-url AUTH_URL</codeph> -- Specifies the Keystone authentication
          URL.</li>
      </ul>
    </p>
    <p><b>Recover / Resync</b></p>
    <p>The following command triggers Attis recover service. Use <codeph>attis help recover</codeph>
      for more information.</p>
    <codeblock>attis recover [-h] [--confid CONFIG_ID] [--report-id REPORT_ID][--os-tenant-name TENANT_NAME] [--os-username USERNAME][--os-password PASSWORD] [--os-auth-url AUTH_URL]</codeblock>
    <p><b>Arguments</b></p>
    <p>
      <ul id="ul_hnd_2y3_pt">
        <li><codeph>--confid CONFIG_ID</codeph> -- Restores Attis using configuration id. Refer to
          attis config </li>
        <li><codeph>--report-id REPORT_ID</codeph> -- Runs recovery for the specified report ID </li>
        <li><codeph>--os-tenant-name TENANT_NAME</codeph> -- Specifies the project (tenant) name of
          the user used to execute the recover. </li>
        <li><codeph>--os-username USERNAME</codeph> -- Specified the user name to execute the
          recover.</li>
        <li><codeph>--os-password PASSWORD</codeph> -- Specifies the password of the user used to
          execute the recover.</li>
        <li><codeph>--os-auth-url AUTH_URL</codeph> -- Specifies the Keystone authentication
          URL.</li>
      </ul>
    </p>
    <p><b>Recovery Report</b></p>
    <p>The following command shows recovery reports. Use 'attis help report' for more
      information.</p>
    <codeblock>attis report [-h] [--list] [--generate] [--id ID] [--name NAME] [--confid CONFIG_ID] [--os--tenant-name TENANT_NAME] [--os--username USERNAME] [--os--password PASSWORD] [--os--auth-url AUTH_URL]</codeblock>
    <p><b>Arguments</b></p>
    <p>
      <ul id="ul_lcj_mtl_pt">
        <li><codeph>--list</codeph> Shows the recovery report. </li>
        <li><codeph>--generate</codeph> Generates the recovery report. </li>
        <li><codeph>--id ID</codeph> Shows the recovery report with specified id </li>
        <li><codeph>--name NAME</codeph> Shows the recovery report with specified name </li>
        <li><codeph>--confid CONFIG_ID</codeph> Generates a recovery report using configuration with
          id. Refer to attis config </li>
        <li><codeph>--os-tenant-name TENANT_NAME</codeph> -- Specifies the project (tenant) name of
          the user used to execute the recovery report. </li>
        <li><codeph>--os-username USERNAME</codeph> -- Specified the user name to execute the
          recovery report.</li>
        <li><codeph>--os-password PASSWORD</codeph> -- Specifies the password of the user used to
          execute the recovery report.</li>
        <li><codeph>--os-auth-url AUTH_URL</codeph> -- Specifies the Keystone authentication
          URL.</li>
      </ul>
    </p>
    <p><b>Restart</b></p>
    <p>The following command restarts the Attis service. Use 'attis help restart' for more
      information.</p>
    <p>
      <codeblock>attis restart [-h] [--config-id CONFIG_ID] [--os-tenant-name TENANT_NAME] [--os-username USERNAME] [--os-password PASSWORD] [--os-auth-url AUTH_URL]</codeblock>
    </p>
    <p><b>Arguments</b></p>
    <p>
      <ul id="ul_lb4_gvl_pt">
        <li><codeph>--config-id CONFIG_ID</codeph> -- Restores using configuration with id. Refer to
          attis config </li>
        <li><codeph>--os-tenant-name TENANT_NAME</codeph> -- Tenant name of the user used to execute
          the restart </li>
        <li><codeph>--os-tenant-name TENANT_NAME</codeph> -- Specifies the project (tenant) name of
          the user used to execute the restart. </li>
        <li><codeph>--os-username USERNAME</codeph> -- Specified the user name to execute the
          restart.</li>
        <li><codeph>--os-password PASSWORD</codeph> -- Specifies the password of the user used to
          execute the restart.</li>
        <li><codeph>--os-auth-url AUTH_URL</codeph> -- Specifies the Keystone authentication
          URL.</li>
      </ul>
    </p>
    <p><b>Storage</b></p>
    <p>The following command shows stored storage configuration for the Attis service. Use 'attis
      help storage' for more information. </p>
    <p><b>Synopsis</b></p>
    <p>
      <codeblock>attis storage --update '{"parameter":"new value", "parameter":"new value"}' --id &lt;storage_id from the table></codeblock>
    </p>
    <p><b>Arguments</b></p>
    <p>
      <ul id="ul_cdh_yvl_pt">
        <li><codeph>--id ID</codeph> Shows storage with specified id, including its parameters and
          values </li>
        <li><codeph>--type TYPE</codeph> Shows storage with specified type </li>
        <li><codeph>--update UPDATE</codeph> Updates storage parameters with new values. Arguments
          should be dictionary format, for example: <codeph>'{"storage_path":
            "/tmp/mybackup"}'</codeph></li>
        <li><codeph>--use USE</codeph> Uses the specified storage type. The default is
            <codeph>SCP</codeph>. </li>
        <li><codeph>--os-tenant-name TENANT_NAME</codeph> -- Specifies the project (tenant) name of
          the user used to execute the storage command. </li>
        <li><codeph>--os-username USERNAME</codeph> -- Specifies the user name to execute the
          storage command.</li>
        <li><codeph>--os-password PASSWORD</codeph> -- Specifies the password of the user used to
          execute the storage command.</li>
        <li><codeph>--os-auth-url AUTH_URL</codeph> -- Specifies the Keystone authentication
          URL.</li>
      </ul>
    </p>
    <table id="table_q5x_5t3_pt">
      <tgroup cols="2">
        <colspec colnum="1" colname="col1"/>
        <colspec colnum="2" colname="col2"/>
        <tbody>
          <row>
            <entry><b>Command</b></entry>
            <entry><b>Action</b></entry>
          </row>
          <row>
            <entry>attis job</entry>
            <entry>shows a list of jobs</entry>
          </row>
          <row>
            <entry>attis job --id JOB_ID</entry>
            <entry>shows detail job of id JOB_ID, including sub-tasks</entry>
          </row>
          <row>
            <entry>attis job --name JOB_NAME</entry>
            <entry>shows a list of jobs with name JOB_NAME</entry>
          </row>
          <row>
            <entry>attis job --last N</entry>
            <entry>shows a list of jobs only in the last N days</entry>
          </row>
          <row>
            <entry>attis job --latest</entry>
            <entry>shows the latest job</entry>
          </row>
          <row>
            <entry>attis config</entry>
            <entry>shows a list of configs</entry>
          </row>
          <row>
            <entry>attis config --id CONFIG_ID</entry>
            <entry>shows detail configs of id CONFIG_ID, including config parameters</entry>
          </row>
          <row>
            <entry>attis config --type TYPE</entry>
            <entry>shows a list of configs with type TYPE (backup/restore)</entry>
          </row>
          <row>
            <entry>attis config --id CONFIG_ID --update '{"timeout": 1200}'</entry>
            <entry>
              <p>updates config from the specified config with new</p>
              <p> values. arguments should be dictionary format</p>
            </entry>
          </row>
          <row>
            <entry>attis config --id CONFIG_ID --update-parameter '{"Percona_XtraDB_Backup_dbuser":
              "myuser", "Percona_XtraDB_Backup_dbpassword": "mypassword"}'</entry>
            <entry>
              <p>updates config parameters from the specified config</p>
              <p> with new values. arguments should be dictionary</p>
              <p> format</p>
            </entry>
          </row>
          <row>
            <entry>attis backuplog</entry>
            <entry>shows a list of backup logs</entry>
          </row>
          <row>
            <entry>attis backuplog --id BACKUP_LOG_ID</entry>
            <entry>shows a list of backup logs with id BACKUP_LOG_ID</entry>
          </row>
          <row>
            <entry>attis backuplog --name BACKUP_LOG_NAME</entry>
            <entry>shows a list of backup logs with name BACKUP_LOG_NAME</entry>
          </row>
          <row>
            <entry>attis backuplog --last N</entry>
            <entry>shows a list of backup logs in the last N days</entry>
          </row>
          <row>
            <entry>attis backuplog --latest</entry>
            <entry>shows the latest backup log</entry>
          </row>
          <row>
            <entry>attis backup --config-id CONFIG_ID</entry>
            <entry>executes backup job with parameters fetched from config id CONFIG_ID</entry>
          </row>
          <row>
            <entry>attis backup --config-id CONFIG_ID --backup_type BACKUP_TYPE</entry>
            <entry>executes BACKUP_TYPE - incremental or full(default) . with parameters fetched
              from confid CONFIG_ID</entry>
          </row>
          <row>
            <entry>attis restore --config-id CONFIG_ID --backup-id BACKUP_ID</entry>
            <entry>executes restore job using config id CONF_ID and BACKUP_ID, which is backup_id
              from "attis backuplog"</entry>
          </row>
          <row>
            <entry>attis report --list</entry>
            <entry>shows a list of re-sync reports</entry>
          </row>
          <row>
            <entry>attis report --list --name REPORT_NAME</entry>
            <entry>shows a list of re-sync reports with name REPORT_NAME</entry>
          </row>
          <row>
            <entry>attis report --id REPORT_ID</entry>
            <entry>shows detail re-sync report of id REPORT_ID</entry>
          </row>
          <row>
            <entry>attis report --generate</entry>
            <entry>generates re-sync report and returns a report ID</entry>
          </row>
          <row>
            <entry>attis recover --config-id CONFIG_ID --report-id REPORT_ID</entry>
            <entry>executes resync job with parameters fetched from config id CONFIG_ID and
              report-id REPORT_ID which user authorized</entry>
          </row>
          <row>
            <entry>attis restart --config-id CONFIG_ID</entry>
            <entry>would restart as using the configuration</entry>
          </row>
          <row>
            <entry>attis storage</entry>
            <entry>shows a list of available storage</entry>
          </row>
          <row>
            <entry>attis storage --id STORAGE_ID</entry>
            <entry>shows detail storage configuration of type STORAGE_ID, including
              parameters</entry>
          </row>
          <row>
            <entry>attis storage --type STORAGE_TYPE</entry>
            <entry>shows the storage configuration with type STORAGE_TYPE</entry>
          </row>
          <row>
            <entry>attis storage --id STORAGE_ID --update '{"storage_path":""}'</entry>
            <entry>updates parameters from the specified storage with new values (arguments should
              be dictionary format)</entry>
          </row>
          <row>
            <entry>attis storage --use STORAGE_TYPE</entry>
            <entry>tells Attis to use the specified STORAGE_TYPE for storing backups</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </body>
</topic>

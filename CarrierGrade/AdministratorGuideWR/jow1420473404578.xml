<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE topic   PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" ><topic domains="(topic task topic)                            (topic hi-d)                            (topic pr-d)                            (topic sw-d)                            (topic ui-d)                            (topic wr-sw-d)                            (topic xml-d)   " id="jow1420473404578" xml:lang="en-us"><!-- Modification History        -->    <title>Adding an Infrastructure Network Using the CLI</title>    <shortdesc >If an infrastructure network is not installed during initial        configuration, you can add one later using the CLI.</shortdesc>    <prolog>        <author />    </prolog>    <body>        <section id="section_N10021_N1001E_N10001" >            <note id="note_N10025_N10021_N1001E_N10001" >                <p >On a cluster with an infrastructure network, each host must have an                    infrastructure interface before it can be unlocked. Ensure that all hosts have                    the required hardware.</p>            </note>        </section>        <section id="section_N1001D_N1001A_N10001" >            <p >For a system with an LVM storage backend, the infrastructure network                is optional. It can be used to offload the internal management network on clusters                with many compute nodes. For more information, see <xref href="jow1404333674324.xml" />.</p>            <p >You can view the existing infrastructure network configuration                using the following command on the active controller (assumed to be <b >controller-0</b> for this discussion).</p>            <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system infra-show</userinput></codeblock>            <codeblock ><systemoutput >+--------------+--------------------------------------+| Property     | Value                                |+--------------+--------------------------------------+| uuid         | cc549ef3-5c81-4fbf-8c50-5163c89e5039 || istate       | applied                              || infra_subnet | None                                 || isystem_uuid | 1bbd29be-c6a2-4e9b-93ce-a8dac3ce8e5c || recordtype   | reconfig                             || created_at   | 2014-12-23T21:15:34.074881+00:00     || updated_at   | 2014-12-31T19:38:43.603320+00:00     |+--------------+--------------------------------------+</systemoutput></codeblock>            <p >You can add an infrastructure network after initial installation.                For this operation, all nodes except the active controller must be locked. During                the change, the nodes cannot be unlocked until the new configuration is applied to                both controllers. In addition, before a node can be unlocked, an infrastructure                interface must be configured on the host.</p>        </section>        <ol>            <li id="li_N1017B_N10178_N1001A_N10001" >                <p >Lock all hosts except the active controller.</p>                                    <p >For each host, use the following command.</p>                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-lock <varname >hostname</varname></userinput></codeblock>                            </li>            <li id="li_N10076_N1004F_N1001E_N10001" >                <p >Add an infrastructure interface on the standby controller.</p>                                    <p >To add an infrastructure network to a dedicated interface,                        use the following command, specifying a name for the network and the port to                        use for the network connection. To identify the port to use for an                        infrastructure network, consult your configuration plan.</p>                    <note id="note_N100A0_N10097_N1008D_N10065_N1001E_N10001" >                        <p >You can also add an infrastructure network to a shared interface as a                            VLAN-tagged network. For more information, see <xref href="jow1423173019489.xml" />.</p>                    </note>                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-if-add -nt infra \<varname >hostname</varname> <varname >interfacename</varname> <varname >port</varname></userinput></codeblock>                    <p >For example:</p>                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-if-add -nt infra \controller-1 infra0 eth3</userinput><systemoutput >+------------------+--------------------------------------+| Property         | Value                                |+------------------+--------------------------------------+| ifname           | infra0                               || networktype      | infra                                || iftype           | ethernet                             || ports            | [u'eth3']                            || providernetworks | None                                 || imac             | 08:00:27:7a:fa:a5                    || imtu             | 1500                                 || aemode           | active_standby                       || schedpolicy      | None                                 || txhashpolicy     | layer2                               || uuid             | d3efde57-c475-402e-acad-34f5029f3988 || ihost_uuid       | 62657285-cc9c-45a2-962e-ecb01647916f || vlan_id          | None                                 || uses             | []                                   || used_by          | []                                   || created_at       | 2014-12-31T20:13:16.326992+00:00     || updated_at       | None                                 |+------------------+--------------------------------------+</systemoutput></codeblock>                            </li>            <li id="li_N100B8_N1004F_N1001E_N10001" >                <p >Add the same infrastructure network on the active controller.</p>                                    <p > For example:</p>                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-if-add -nt infra \controller-0 infra0 eth3</userinput><systemoutput >+------------------+--------------------------------------+| Property         | Value                                |+------------------+--------------------------------------+| ifname           | infra0                               || networktype      | infra                                || iftype           | ethernet                             || ports            | [u'eth3']                            | | providernetworks | None                                 || imac             | 08:00:27:51:58:6b                    || imtu             | 1500                                 || aemode           | active_standby                       || schedpolicy      | None                                 || txhashpolicy     | layer2                               || uuid             | 66c4543e-6bfd-4ede-9b8a-4d091cf290a9 || ihost_uuid       | 3c11607b-1550-4e99-a46f-2580c18683da || vlan_id          | None                                 || uses             | []                                   || used_by          | []                                   || created_at       | 2014-12-31T20:29:51.759507+00:00     || updated_at       | None                                 |+------------------+--------------------------------------+</systemoutput></codeblock>                            </li>            <li id="li_N100DB_N1004F_N1001E_N10001" >                <p >Specify the infrastructure subnet.</p>                                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system infra-modify \infra_subnet=<varname >subnet/mask</varname> action=apply</userinput></codeblock>                    <p >For example:</p>                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system infra-modify \infra_subnet=192.168.205.0/24 action=apply</userinput><systemoutput >+--------------+--------------------------------------+| Property     | Value                                |+--------------+--------------------------------------+| uuid         | cc549ef3-5c81-4fbf-8c50-5163c89e5039 || istate       | applying                             || infra_subnet | 192.168.205.0/24                     || isystem_uuid | 1bbd29be-c6a2-4e9b-93ce-a8dac3ce8e5c || recordtype   | reconfig                             || created_at   | 2014-12-23T21:15:34.074881+00:00     || updated_at   | 2015-01-02T16:06:39.275800+00:00     |+--------------+--------------------------------------+</systemoutput></codeblock>                            </li>            <li id="li_N10114_N1004F_N1001E_N10001" >                <p >Reboot the standby controller.</p>                                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-reboot controller-1</userinput></codeblock>                    <p >This updates its configuration.</p>                    <p >Wait for the standby controller to reboot. To monitor its                        status, use the following command.</p>                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >watch -n 5 system host-list</userinput></codeblock>                    <p >This displays a refreshed host list every five seconds.                        Monitor the output until the standby controller is shown as <b >locked</b> and <b >online</b>. To stop monitoring, enter <userinput >CTRL-C</userinput>.</p>                    <note id="note_N10154_N10139_N1012F_N10065_N1001E_N10001"  type="caution">                        <p >To prevent potential service conflicts due to                            inconsistent controller network configurations, do not unlock the                            standby controller until the active controller is also rebooted.</p>                    </note>                            </li>            <li id="li_N10149_N1004F_N1001E_N10001" >                <p >Reboot the active controller.</p>                                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >sudo reboot</userinput><systemoutput >The system is going down for reboot NOW!</systemoutput></codeblock>                    <p >Wait for the controller to reboot.</p>                            </li>            <li id="li_N10171_N1004F_N1001E_N10001" >                <p >Log in to the active controller and become the Keystone                        <b >admin</b> user.</p>                                    <codeblock ><systemoutput >$ </systemoutput><userinput >source /etc/nova/openrc</userinput></codeblock>                            </li>            <li id="li_N10190_N1004F_N1001E_N10001" >                <p >Unlock the standby controller.</p>                                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-unlock controller-1</userinput><systemoutput >+-----------------+--------------------------------------+| Property        | Value                                |+-----------------+--------------------------------------+| action          | none                                 || administrative  | locked                               || availability    | online                               || bm_ip           |                                      || bm_mac          |                                      || bm_type         | None                                 || bm_username     |                                      || capabilities    | {}                                   || created_at      | 2014-12-24T16:44:08.749540+00:00     || cstatus         |                                      || hostname        | controller-1                         || iconfig_applied | 76aa6a81-620a-4ba2-85c3-113d1c42f5ec || iconfig_fini    | 76aa6a81-620a-4ba2-85c3-113d1c42f5ec || iconfig_target  | 76aa6a81-620a-4ba2-85c3-113d1c42f5ec || id              | 5                                    || invprovision    | unprovisioned                        || location        | {u'locn': u'Rack 1 Pos 2'}           || mgmt_ip         | 192.168.204.4                        || mgmt_mac        | 08:00:27:ba:e8:52                    || operational     | disabled                             || personality     | controller                           || reserved        | False                                || serialid        | None                                 || task            | Unlocking                            || updated_at      | 2015-01-02T17:12:56.464592+00:00     || uptime          | 1955                                 || uuid            | 62657285-cc9c-45a2-962e-ecb01647916f |+-----------------+--------------------------------------+</systemoutput></codeblock>                            </li>            <li id="li_N101B3_N1004F_N1001E_N10001" >                <p >Add infrastructure interfaces to each compute node.</p>                                    <p >For each node, use the following command.</p>                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-if-add -nt infra \<varname >hostname</varname> <varname >networkname</varname> <varname >port</varname></userinput><systemoutput >+------------------+--------------------------------------+| Property         | Value                                |+------------------+--------------------------------------+| ifname           | infra0                               || networktype      | infra                                || iftype           | ethernet                             || ports            | [u'eth0']                            || providernetworks | None                                 || imac             | 08:00:27:20:d2:d1                    || imtu             | 1500                                 || aemode           | active_standby                       || schedpolicy      | None                                 || txhashpolicy     | layer2                               || uuid             | d664ad66-58fa-4378-b906-ae417d58dbf0 || ihost_uuid       | 43b462ac-05fc-43dd-82de-160c7ab0923f || vlan_id          | None                                 || uses             | []                                   || used_by          | []                                   || created_at       | 2015-01-02T17:33:37.138694+00:00     || updated_at       | None                                 |+------------------+--------------------------------------+</systemoutput></codeblock>                    <p >You can now unlock the compute nodes. This clears any                            <b >Configuration out-of-date</b>                        errors.</p>                    <p ><!-- At this point system host-if-show controller-0 eth3 says there is no eth3. . . --></p>                            </li>        </ol>    </body></topic>
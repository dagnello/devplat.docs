<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE topic   PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >


<topic id="psa1410446976545" xml:lang="en-us">


<!-- Modification History


        


-->


    <title>Installing Patches</title>


    <shortdesc >Patches in the patch storage area can be selected to be installed to


        the cluster, one, several, or all patches at a time. When selected, they are moved into the


        software updates repository from where they must be subsequently installed on each impacted


        host in the cluster.</shortdesc>


    <prolog>


        <author >Pedro Sanchez</author>


    </prolog>


    <body>


        <section id="section_N1001E_N1001B_N10001" >


            <p >Installing a patch to the cluster means installing it to each and


                every host of the type where the patch is relevant. For example, one patch can be


                installed on the controller nodes only, while another can be installed on all host


                types. Since a patch is not necessarily installed on all applicable hosts


                simultaneously, patching the entire cluster can take some time.</p>


            <p >As a patch is installed to the cluster, it goes through the following


                state transitions:</p>


            <dl>


                <dlentry >


                    <dt ><i >Available</i> to <i >Partial-Apply</i></dt>


                    <dd >


                        <p >A patch in the <i >Partial-Apply</i> state


                            indicates that it has been installed on zero or more, but not all, the


                            applicable hosts.</p>


                        <p >Use the command <i>wrs-patch


                                apply</i> to trigger this transition. The patch moves from the


                            patch storage area to the software updates repository and becomes ready


                            to be installed on the applicable hosts.</p>


                    </dd>


                </dlentry>


                <dlentry >


                    <dt ><i >Partial-Apply</i> to <i >Applied</i></dt>


                    <dd >


                        <p >A patch in the <i >Applied</i> state


                            indicates that it has been installed on all applicable hosts.</p>


                        <p >Use the command <i>wrs-patch


                                host-install</i> repeatedly targeting each time one of the


                            applicable hosts in the cluster. The transition to the <i >Applied</i> state is complete when the patch is


                            installed on all target hosts.</p>


                    </dd>


                </dlentry>


            </dl>


            <p >The following example illustrates the process of installing a single


                patch on the cluster. It assumes that the patch is in the <i >Available</i> state already, as described in <xref href="psa1410446807133.xml" />, and that only the controller nodes must be patched.</p>


        </section>


        <ol>


            <li conref="psa1410446807133.xml#psa1410446807133/cli-admin-login" id="li_N10084_N10081_N1001F_N10001" >


                <p />


            </li>


            <li id="li_N1002A_N10027_N1001B_N10001" >


                <p >Verify that the patches are available using the command <i>wrs-patch query</i>.</p>


                


                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >sudo wrs-patch query</userinput>


<systemoutput >﻿       Patch ID             Patch State


=========================   ===========


PATCH_0001   Available


PATCH_0002   Available


PATCH_0003   Available</systemoutput></codeblock>


                


            </li>


            <li id="li_N100AD_N10081_N1001F_N10001" >


                <p >Apply the patch.</p>


                


                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >sudo wrs-patch apply PATCH_0001</userinput>


<systemoutput >PATCH_0001 is now in the repo</systemoutput></codeblock>


                


                


                    <p >The patch is now in the <i >Partial-Apply</i>


                        state, ready for installation from the software updates repository on the


                        impacted hosts.</p>


                


            </li>


            <li id="li_N100FB_N1009F_N1001F_N10001" importance="optional" >


                <p >Apply all available patches in a single operation.</p>


                


                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >sudo wrs-patch apply --all</userinput>


<systemoutput >PATCH_0001 is now in the repo</systemoutput>


<systemoutput >PATCH_0002 is now in the repo</systemoutput>


<systemoutput >PATCH_0003 is now in the repo</systemoutput></codeblock>


                


                


                    <p >In this example there are three patches ready now for


                        installation from the software updates repository.</p>


                


            </li>


            <li id="li_N1012A_N1009F_N1001F_N10001" >


                <p >Query the patching status of all hosts in the cluster.</p>


                


                    <p >You can query the patching status of all hosts at any time as


                        illustrated below. Note that the reported status is the accumulated result


                        of all applied and removed patches in the software updates repository, and


                        not just the status due to a particular patch.</p>


                


                


                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >sudo wrs-patch query-hosts</userinput>


<systemoutput >﻿  Hostname      IP Address    Patch Current  Reboot Required


============  ==============  =============  ===============


compute-0     192.168.204.15       Yes             No


controller-0  192.168.204.3        No              Yes


controller-1  192.168.204.4        No              Yes</systemoutput></codeblock>


                


                


                    <p >For each host in the cluster, the following patch status


                        fields are displayed:</p>


                    <dl>


                        <dlentry >


                            <dt >Patch Current</dt>


                            <dd >


                                <p >Indicates whether there are patches pending for


                                    installation or removal on the host or not. If <i >Yes</i>, then all relevant patches in the


                                    software updates repository have been installed on, or removed


                                    from, the host already. If <i >No</i>, then there


                                    is at least one patch in either the <i >Partial-Apply</i> or <i >Partial-Remove</i>


                                    states that has not been applied to the host.</p>


                            </dd>


                        </dlentry>


                        <dlentry >


                            <dt >Reboot Required </dt>


                            <dd >


                                <p >Indicates whether the host has to be rebooted or


                                    not as a result of one or more patches that have been either


                                    applied or removed, or because it is not patch current.</p>


                            </dd>


                        </dlentry>


                    </dl>


                    <p >In this example, <b >compute-0</b> is up to date, no patches need to be installed


                        and no reboot is required. By contrast, the controllers are not patch


                        current, and therefore a reboot is required to install the patch.</p>


                


            </li>


            <li id="li_N10190_N1009F_N1001F_N10001" >


                <p >Install all pending patches on <b >controller-0</b>.</p>


                <ol id="ol_kzv_x13_pp">


                    <li >


                        <p >Swact controller services.</p>


                        


                            <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-swact controller-0</userinput></codeblock>


                        


                        


                            <p >Before patching a controller node, you must transfer


                                any active services running on the host to the other controller.


                                Only then it is safe to lock the host.</p>


                        


                    </li>


                    <li >


                        <p >Run the patching sequence.</p>


                        


                            <p >The patching sequence locks the host, installs the


                                patches, and forces a host reboot.</p>


                        


                        


                            <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-patch-reboot controller-0</userinput>


<systemoutput >host-patch-reboot controller-0 may take several minutes to complete.


 


2014-10-17-20-39-59_host-patch-reboot start.


...


 


2014-10-17-20-39-59_host-patch-reboot host-lock.


waiting for host controller-0 to transition to locked-disabled-online ...


waiting for host controller-0 to transition to locked-disabled-online ...


2014-10-17-20-40-14_Host controller-0 is locked-disabled-online.


 


2014-10-17-20-40-14_Patch install request


Installing patch for host controller-0 ...


 


2014-10-17-20-40-16_Patch install response


Patch response Info: Patch installation was successful on controller-0.


 


2014-10-17-20-40-16_host-patch-reboot host-unlock


Restoring initial administrative state: unlocked. Unlocking host controller-0 to return to initial administrative state.</systemoutput></codeblock>


                        


                    </li>


                </ol>


                


                    <p >All patches are now installed on <b >controller-0</b>. Querying the current patch


                        status displays the following information:</p>


                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >sudo wrs-patch query-hosts</userinput>


<systemoutput >﻿  Hostname      IP Address    Patch Current  Reboot Required


============  ==============  =============  ===============


compute-0     192.168.204.15       Yes             No


controller-0  192.168.204.3        Yes             No


controller-1  192.168.204.4        No              Yes</systemoutput></codeblock>


                


            </li>


            <li id="li_N1023A_N100A0_N1001F_N10001" importance="optional" >


                <p >Manually install all pending patches on <b >controller-0</b>.</p>


                


                    <p >You may want to have finer control of the patching ol


                        executed by the <i>system host-patch-reboot</i>


                        command to determine when to install the patches and unlock the host.</p>


                


                <ol id="ol_ck5_3qx_5p">


                    <li >


                        <p >Swact controller services.</p>


                        


                            <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-swact controller-0</userinput></codeblock>


                        


                        


                            <p >Before patching a controller node, you must transfer


                                any active services running on the host to the other controller.


                                Only then it is safe to lock the host.</p>


                        


                    </li>


                    <li >


                        <p >Lock the host.</p>


                        


                            <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-lock controller-0</userinput></codeblock>


                        


                        


                            <p >You must lock the target host, controller, compute,


                                or storage, before installing patches.</p>


                        


                    </li>


                    <li >


                        <p >Install the pending patches.</p>


                        


                            <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >sudo wrs-patch host-install controller-0</userinput>


<systemoutput >Patch installation was successful on controller-0</systemoutput></codeblock>


                        


                        


                            <p >All patches are now installed on <b >controller-0</b>. Querying the


                                current patching status displays the following information:</p>


                            <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >sudo wrs-patch query-hosts</userinput>


<systemoutput >﻿  Hostname      IP Address    Patch Current  Reboot Required


============  ==============  =============  ===============


compute-0     192.168.204.15       Yes             No


controller-0  192.168.204.3        Yes             Yes


controller-1  192.168.204.4        No              Yes</systemoutput></codeblock>


                            <p >For illustration purposes in this section, the


                                command <i>wrs-patch host-install</i>


                                is presented as the tool to <i >install</i> patches.


                                But in fact, this command also <i >removes</i>


                                patches as well, as described in <xref href="psa1410446902796.xml" />. The command is better described then as the


                                tool to install and remove all patches in the <i >Partial-Apply</i> and <i >Partial-Remove</i>


                                states on a host.</p>


                        


                    </li>


                    <li >


                        <p >Unlock the target host.</p>


                        


                            <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-unlock controller-0</userinput></codeblock>


                        


                        


                            <p >Unlocking the host forces a reset of the host


                                followed by a reboot. This ensures that the host is restarted in a


                                known state.</p>


                        


                    </li>


                </ol>


                


                    <p >All patches are now installed on <b >controller-0</b>.</p>


                


            </li>


            <li id="li_N10260_N1009F_N1001F_N10001" >


                <p >Install all pending patches on <b >controller-1</b>.</p>


                


                    <p >Repeat the previous li targeting <b >controller-1</b>


                        this time.</p>


                


                


                    <p >All patches are now installed on <b >controller-1</b> as well. Querying the


                        current patching status displays the following information:</p>


                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >sudo wrs-patch query-hosts</userinput>


<systemoutput >﻿  Hostname      IP Address    Patch Current  Reboot Required


============  ==============  =============  ===============


compute-0     192.168.204.15       Yes             No


controller-0  192.168.204.3        Yes             No


controller-1  192.168.204.4        Yes             No</systemoutput></codeblock>


                


            </li>


        </ol>





            <p >The cluster is up to date now. All patches are installed.</p>


        


    </body>


</topic>
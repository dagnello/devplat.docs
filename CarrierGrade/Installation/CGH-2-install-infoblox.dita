<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic15959">
  <title>HPE Helion <tm tmtype="reg">OpenStack</tm> 2.0 Carrier Grade Beta: Installing Infoblox<tm
      tmtype="reg"/></title>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HPE Helion Openstack"/>
      <othermeta name="product-version" content="HPE Helion Openstack 1.1"/>
      <othermeta name="role" content="All"/>
      <othermeta name="role" content="Amanda F"/>
      <othermeta name="product-version1" content="HPE Helion Openstack"/>
      <othermeta name="product-version2" content="HPE Helion Openstack 1.1"/>
    </metadata>
  </prolog>
  <body>
    <p><!--https://wiki.hpcloud.net/display/HCG/Infoblox-+HCG+2.0+integration--></p>
    <p>Infoblox is an optional component of the Memphis and Sacramento deployments.  </p>
    <p>The Infoblox OpenStack Adapter (IOA) integrates with the OpenStack Neutron networking
      service, to provide IP Address Management (IPAM) networking services within OpenStack cloud
      platforms.Refer to the Infoblox documentation for operation and maintenance information. </p>
    <p>If you are not installing Infoblox, go to <xref
        href="carrier-grade-install-launch-horizon.dita#topic10581">Launching the Horizon
        Interface</xref>.</p>
    <section>
      <p><b>Deploy and Configure Infoblox Openstack Adapter (IOA) VM in ESX</b></p>
      <p>Infoblox vNIOS™ (Network Infrastructure Operating System) for VMware® allows deployment of
        a virtualized instance of an Infoblox appliance. You can use ESX vCenter to import the
        template and deploy the Infoblox IOA VM.</p>
      <p>To deploy the template in ESX:<ol id="ol_ezn_ybt_xs">
          <li>Launch the VMware vCenter client.</li>
          <li>Click <b>File</b>, then <b>Deploy OVF Template</b>.</li>
          <li>In the <b>Deploy OVF Template</b> wizard, browse to the location of the
              <codeph>nios-7.0.2-269928-2015-02-10-18-03-07-160G-820.ova</codeph> file.</li>
          <li>Click <b>Next</b> and complete the wizard:</li>
          <li>Review the details for the installation and click <b>Finish</b>.</li>
        </ol></p>
    </section>
    <section>
      <title>Configure the </title>
      <ol id="ol_rly_5jz_5t">
        <li>Power on vNIOS VM. </li>
        <li>Login to VM console from vCenter using the default credentials (admin/infoblox)</li>
        <li>Run command <b>set network</b> to configure IP address of vNIOS </li>
        <li>Run the <b>set temp_license</b> command to configure trial license (60 days). Choose
          option 8 </li>
        <li>Point a browser to the default Infoblox URL at
            <codeph>https://10.200.51.240/ui/</codeph>.</li>
        <li>Log into the Infoblox portal using the default credentials admin/infoblox. <p>When you
            login for the first time you will be prompted for intial setup select options. Proceed
            through the setup wizard.</p></li>
        <li>Go to <b>Administration > Extensible Attributes</b> and click <b>Configure Extensible
            Attributes</b>.</li>
        <li>Create the following extensible attributes: <table id="table_mvd_rfz_5t">
            <tgroup cols="3">
              <colspec colnum="1" colname="col1"/>
              <colspec colnum="2" colname="col2"/>
              <colspec colnum="3" colname="col3"/>
              <tbody>
                <row>
                  <entry>Name</entry>
                  <entry>Type </entry>
                  <entry>Comments </entry>
                </row>
                <row>
                  <entry>Account</entry>
                  <entry>String </entry>
                  <entry> UserID inOpenStack </entry>
                </row>
                <row>
                  <entry> CMP Type</entry>
                  <entry>String </entry>
                  <entry> CMPtypes(OpenStack) </entry>
                </row>
                <row>
                  <entry>Cloud API Owned</entry>
                  <entry>String </entry>
                  <entry> Cloud API Owned</entry>
                </row>
                <row>
                  <entry> Is External </entry>
                  <entry> String </entry>
                  <entry> For networks and network containers only </entry>
                </row>
                <row>
                  <entry>Is Shared </entry>
                  <entry>String </entry>
                  <entry>For networks and network containers only </entry>
                </row>
                <row>
                  <entry>IP Type</entry>
                  <entry>String </entry>
                  <entry> Typeof IP address </entry>
                </row>
                <row>
                  <entry>Network Encap </entry>
                  <entry>String </entry>
                  <entry> </entry>
                </row>
                <row>
                  <entry>Network ID </entry>
                  <entry>String </entry>
                  <entry>NetworkID inOpenStack </entry>
                </row>
                <row>
                  <entry>Network Name </entry>
                  <entry>String </entry>
                  <entry>Networkname </entry>
                </row>
                <row>
                  <entry>PhysicalNetworkName </entry>
                  <entry>String </entry>
                  <entry> </entry>
                </row>
                <row>
                  <entry> Port Attached Device - Device ID </entry>
                  <entry>String </entry>
                  <entry> </entry>
                </row>
                <row>
                  <entry>Port Attached Device - Device Owner </entry>
                  <entry>String </entry>
                  <entry> </entry>
                </row>
                <row>
                  <entry>Port ID </entry>
                  <entry>String </entry>
                  <entry> </entry>
                </row>
                <row>
                  <entry>Segmentation ID </entry>
                  <entry>String </entry>
                  <entry> </entry>
                </row>
                <row>
                  <entry>Subnet ID </entry>
                  <entry>String </entry>
                  <entry>Subnet ID in OpenStack </entry>
                </row>
                <row>
                  <entry>Subnet Name </entry>
                  <entry>String </entry>
                  <entry>Subnet name in OpenStack </entry>
                </row>
                <row>
                  <entry>Tenant ID </entry>
                  <entry>String </entry>
                  <entry>TenantID in OpenStack </entry>
                </row>
                <row>
                  <entry>Tenant Name </entry>
                  <entry>String</entry>
                  <entry>Tenant Name in OpenStack </entry>
                </row>
                <row>
                  <entry>VLAN ID </entry>
                  <entry>Integer</entry>
                  <entry>The VLANID in OpenStack </entry>
                </row>
                <row>
                  <entry>VM ID </entry>
                  <entry>String </entry>
                  <entry>InstanceID in OpenStack </entry>
                </row>
                <row>
                  <entry>VM Name </entry>
                  <entry>String </entry>
                  <entry>Virtual machine instance name inOpenStack </entry>
                </row>
              </tbody>
            </tgroup>
          </table></li>
      </ol>
    </section>
    <section>
      <title id="Infoblox-HCG2.0integration-Applypatch">Apply patch</title>
      <ol id="ul_ovd_rfz_5t">
        <li>Log into the HML node.</li>
        <li>Copy the <codeph>infoblox.tar.gz</codeph> patch to:
            <codeph>&lt;cloudname>/001/stage/ansible/</codeph>.</li>
        <li>Change to the <codeph>&lt;cloudname>/001/stage/ansible/</codeph> directory.</li>
        <li>Use the following command to extract the
          patch<codeblock>tar -zvxf infoblox.tar.gz</codeblock></li>
        <li>Modify the
            <codeph>/var/hlm/clouds/&lt;cloudname>/desired_state/&lt;cloudname>/001/base/stage/ansible/deploy-infoblox.yml</codeph>
          file to add the appropriate cloud name. Replace the <codeph>&lt;CLOUDNAME></codeph> with
          the name of the cloud.</li>
        <li>Modify the
            <codeph>/var/hlm/clouds/&lt;cloudname>/desired_state/&lt;cloudname>/001/base/stage/ansible/rollback-infoblox.yml</codeph>
          to add the appropriate cloud name. Replace the <codeph>&lt;CLOUDNAME></codeph> with the
          name of the cloud</li>
        <li>Modify the
            <codeph>/var/hlm/clouds/&lt;cloudname>/desired_state/&lt;cloudname>/001/base/stage/ansible/roles/infoblox/defaults/main.yml
          </codeph> file to include environment variables: <ul id="ul_rvd_rfz_5t">
            <li><i>ioa_ipaddress</i>: &lt;IP ADDRESS OF THE INFOBLOX OPENSTACK ADAPTER VM></li>
            <li><i>ioa_username</i>: &lt;USERNAME TO LOGIN TO INFOBLOX OPENSTACK ADAPTER></li>
            <li><i>ioa_password</i>: &lt;PASSWORD TO LOGIN TO INFOBLOX OPENSTACK ADAPTER> </li>
            <li><i>certfile_path</i>: &lt;CERTFILE PATH AS DEFINED IN STACKRC></li>
          </ul></li>
        <li>Execute following command to apply patch:
          <codeblock>ansible-playbook -i hosts deploy-infoblox.yml</codeblock></li>
      </ol>
    </section>
    <section>
      <p><b>Edit configuration files</b></p>
      <ol id="ol_wkc_4s4_xt">
        <li>On the HLM VM, modify the <codeph>/etc/neutron/neutron.conf</codeph> file with values
          apprapriate for your environment:
          <codeblock>[keystone_authtoken]
auth_url = http://BUILD19-CCP-T2-VIP-INTF0-1551:35357

[DEFAULT]

ipam_driver = neutron.ipam.drivers.infoblox.infoblox_ipam.InfobloxIPAM
infoblox_members_config = /etc/neutron/infoblox_members.conf
conditional_config = /etc/neutron/infoblox_conditional.conf
use_host_records_for_ip_allocation = False
bind_dns_records_to_fixed_address = record:a,record:aaaa,record:ptr
unbind_dns_records_from_fixed_address = record:a,record:aaaa,record:ptr
delete_dns_records_associated_with_fixed_address = record:a,record:aaaa,record:ptr,record:txt
subnet_shared_for_creation = true
subnet_shared_for_deletion = true
infoblox_wapi = https://10.200.51.240/wapi/v2.0/
infoblox_username = admin
infoblox_password = infoblox

nova_admin_username = nova
nova_admin_password = {{ NOV_API.consumes_KEY_API.vars.keystone_nova_password }}
nova_admin_tenant_id = {{ tenant_id.stdout }}
nova_admin_tenant_name = services

[nova]
# PEM encoded client certificate cert file
certfile = /etc/stunnel/ssl/hlm/certs/ca.crt

# Name of nova region to use. Useful if keystone manages more than one region.

region_name = Memphis</codeblock></li>
        <li>Modify the <codeph>/etc/neutron/infoblox_conditional.conf</codeph> file with values
          apprapriate for your environment:
          <codeblock>[
   {
        "condition": "subnet_range:10.100.1.0/24",
        "is_external": false,
        "network_view": "management",
        "disable_dhcp": true,
        "dhcp_members": "infoblox.localdomain",
        "require_dhcp_relay": false,
        "domain_suffix_pattern": "{subnet_name}.cloud.global.com",
        "hostname_pattern": "{instance_name}-{ip_address}"
    },
    {
        "condition": "tenant",
        "is_external": false,
        "network_view": "{tenant_name}",
        "disable_dhcp": true,
        "dhcp_members": "infoblox.localdomain",
        "require_dhcp_relay": false,
        "domain_suffix_pattern": "{subnet_name}.cloud.global.com",
        "hostname_pattern": "{instance_name}-{ip_address}"
    },
    {
        "condition": "global",
        "is_external": true,
        "network_view": "default",
        "disable_dhcp": true,
        "dhcp_members": "infoblox.localdomain",
        "require_dhcp_relay": false,
        "domain_suffix_pattern": "{subnet_name}.cloud.global.com",
        "hostname_pattern": "{instance_name}-{ip_address}"
    }
]</codeblock></li>
        <li>Create the <codeph>/etc/neutron/infoblox_members.conf</codeph> file with the following
          line to include IOA VM IP address. <p>
            <codeblock>[{"ipv4addr": "10.200.51.240", "name": "infoblox.localdomain"}]</codeblock>
          </p><p>
            <b>Note:</b> In this example, 10.200.51.240 is the CLM IP of the IOA VM running in the
            ESX environment which was provided during IOA configuration.</p></li>
      </ol>
    </section>
    <section>
      <p><b>Verification</b></p>
      <p>
        <ol id="ol_lhr_rt4_xt">
          <li>Point a browser to the default Infoblox URL at
              <codeph>https://10.200.51.240/ui/</codeph>.</li>
          <li>Log into the Infoblox portal using the default credentials admin/infoblox. </li>
          <li>Go to <b>Administration > Network views</b>. The subnet pool should be listed.</li>
        </ol>
      </p>
    </section>
    <section id="next-step">
      <title>Next Step</title>
      <p><xref href="carrier-grade-install-launch-horizon.dita#topic10581">Launching the Horizon
        Interface</xref></p>
    </section>
  </body>
</topic>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" ><topic xml:lang="en-us" id="topic10581">
<title>HPE Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 2.0 Beta: Deploying the HLM VM and
    Installation Services</title>
<prolog>
  <metadata>
    <othermeta name="layout" content="default"/>
    <othermeta name="product-version" content="HPE Helion Openstack Carrier Grade 1.1"/>
    <othermeta name="role" content="Storage Administrator"/>
    <othermeta name="role" content="Storage Architect"/>
    <othermeta name="role" content="Michael B"/>
    <othermeta name="product-version1" content="HPE Helion Openstack Carrier Grade 1.1"/>
  </metadata>
</prolog>
<body>
  <p>The first phase of the HPE Helion OpenStack Carrier Grade installation involves creating a
      bootstrapping the HPE Helion Lifecycle Management virtual machine and installation services. </p>
    <p>The installation uses Ansible playbooks, which are files that contain scripts that execute
      required installation processes.</p>
  <p><b>Note:</b> If you are installing the <b>Sacramento</b> deployment, before deploying the HLM
      VM, go to <xref href="carrier-grade-install-baremetal-cloud-prepare.dita#topic1107">Preparing
        the Baremetal Region</xref>.</p>

<section id="prepare"> <title>Prepare the system for deployment</title>
<p>Use the following steps to prepare the server on which the HLM VM will be deployed (the HLM host):</p>
<ol>
        <li>Log into the HLM host using the default credentials</li>

  <li>Edit the <codeph>/root/infra-ansible-playbooks/group_vars/all</codeph> file for your
          environment. For information on each variable, refer to the comments in the file with each
          variable. <p>The <codeph>group_vars/all</codeph> file should appear similar to the
            following for a KVM + ESX
          deployment:</p><codeblock>############################################# Variables for HLM  #################################################################
#These variables are relevant in both All Virtual and BareMetal scenarios.
              
#Set this to 1 if you will not deploy a dcn cloud via this HLM node and will deploy only ovs cloud
ovs_cloud_only:  0
              
#Set this to 'bm' if cloud is being deployed over baremetal.
#Set this to 'av' if the cloud is all virtual
cloud_type: 'bm'
              
#These are hlm related variables that must be changed according to your Baremetal Env
hlm_login_id:       root
hlm_password:       cghelion
              
#The following variables are for CLM network IP details for HLM
hlm_clmstaticip:    10.x.x.x
hlm_clmnetmask:     255.255.255.0
hlm_clmgateway:     10.x.x.x
              
#The variables starting with cobbler_ are inputs that are usually given to initcobbler.sh. Set accordingly.
cobbler_pxestartip: 10.x.x.x
cobbler_pxeendip:   10.x.x.x
cobbler_pxestaticip: 10.x.x.x
cobbler_pxenetmask: 255.255.255.0
              
#Set the location of your images that will be used by libvirt
imagelocation: /var/lib/libvirt/images
              
#Set the location of your infra-ansible-playbooks
ansible_dir: ~/infra-ansible-playbooks
              
##################################################################################################################################
              
############################################# Variables for DCN ##################################################################
#Set the location of dcn bits on KVM
#There must be 4 debs, 2 tar.gz files, 1 vsc qcow2
#You must copy your VSD qcow2 to the imagelocation on the KVM if you want to provision it on the same KVM as the HLM
dcn_dir: ~/cg/dcn
##################################################################################################################################
              
############################################# Variables for VSD ##################################################################
#Ignore these variables if VSD is created manually. This section is relevant only for DCN cloud - in both BM and All Virtual cases
#These variables are used for VSD Configuration
#If you have already configured a VSD and ignore the following variables
              
dns_domain_name: dcn-one.helion.cg
dns_address: 10.x.x.x
vsd_address: 10.x.x.x
vsd_gateway: 10.x.x.x
vsd_netmask: 255.255.255.0
vsd_name: vsd1
vsdimagename: VSD-3.0.0_HP_r3.0_36
upstream_ntp_servers:
- 10.x.x.x
- 16.x.x.x
###################################################################################################################################</codeblock></li>
  <li id="hosts">Check the <codeph>/root/infra-ansible-playbooks/hosts</codeph> file to enter the IP
          address of the <codeph>vibr0</codeph> interface in the <codeph>hlm_kvm_host</codeph>
          field, as shown in the following example. </li>
</ol>
<codeblock>  [hlm_kvm_host]
  192.168.122.1 </codeblock>
</section>
<section id="deploy-the-hlm-and-vsd-vm">
      <title>Deploy the HLM Virtual Machine</title>
      <p>Use the following steps on the HLM host to deploy the HLM VM on the HLM Host using Ansible
        playbooks.</p>
      <ol>
        <li>Execute the following command: <codeblock>ansible-playbook -i hosts setup_hlm_onBM.yml</codeblock>
          <!-- The command will do the following:<ul><li>Copy both installation files (tar balls) to the HLM host, decrypt, 
            and extract the files.</li>
            <li>Execute the <codeph>updatepackages</codeph> command.</li>
            <li>Execute the <codeph>prepareenv</codeph> command.</li><li>Execute the <codeph>Init cobbler</codeph> command.</li><li>Execute the <codeph>Importiso</codeph> command.<p>You will see a message similar to the following image when the playbook is run successful:</p></li></ul>-->
          <image href="../../media/CGH-ansible-playbook-run.png" id="image_bfp_pjm_vs">
            <alt>Sample Ansible Playbook run output</alt>
          </image></li>
        <li>Locate the IP address for the HLM VM in the
            <codeph>/root/infra-ansible-playbooks/group_vars/all</codeph> file of the HLM host under
            <codeph>hlm_clmstaticip</codeph> field. You will use this IP address to SSH into the HLM
          VM during the HPE Helion OpenStack Carrier Grade installation process.</li> 
      </ol>
</section>
    <section>
      <title>Configure Networking for the Baremetal Region</title>
      <p>If you are deploying the baremetal region, perform the following tasks:</p>
      <p>
        <ol id="ol_uvk_chg_vt">
          <li>Execute the following command to add a BM-CTL route in HLM:
              <codeblock>route add default gw &lt;ip-address> dev &lt;int></codeblock><p>Where
                <codeph>&lt;ip-address></codeph> is the gateway and <codeph>&lt;eth></codeph> is the
              Ethernet interface.</p><p>For
              example:<codeblock>route add default gw 192.168.122.1 dev eth0</codeblock></p></li>
          <li>Make sure that the vNet corresponding to eth0 is part of virbr0 bridge on the HLM
            host.<p/></li>
        </ol>
        <ul id="ul_ict_bhg_vt">
          <li>3. Verify that all iLO ips of the controller blades/DLs are pingable from HLM.</li>
        </ul>
        <ul id="ul_jct_bhg_vt">
          <li/>
        </ul>
      </p>
    </section>
    <section>
      <title>Update the Debain Repository Index File</title>
      <p>HPE Helion OpenStack Carrier Grade maintains a local Debian repository on the HLM host from
        where Debain packages are installed. The <codeph>dpkg-scanpackages</codeph> script creates a
        package index that enables package installation in such way that if someone executes the
          <codeph>apt-get install &lt;packagename></codeph> command, the index would indicate the
        correct package to install. </p>
      <ol id="ol_yhm_ylr_st">
        <li>Copy the following Debian packages to <codeph>/var/cache/hlm/repo/debian/</codeph>. You
          should have <xref href="carrier-grade-install-prereqs.dita#topic7148/getinstall"
            >downloaded these files in the
          Prerequisites</xref>.<codeblock>protobuf-c0_0.14-1+b1_amd64.deb
python-setproctitle_1.1.8-1_amd64.deb
nuagenetlib_0.0.0-1729-kilo_all.deb
nuage-openstack-neutron_2015.1.1729_all.deb</codeblock></li>
        <li>Remove the following files from the <codeph>/var/cache/hlm/repo/debian/</codeph>
          directory:
          <codeblock>nuagenetlib_2015.1.3.2.4.133_all.deb
nuage-openstack-neutron_2015.1.1725_all.deb</codeblock></li>
        <li>Change to the <codeph>/var/cache/hlm/repo/debian/</codeph> directory.</li>
        <li>Execute the <codeph>dpkg-scanpackages</codeph> command to update Debian repositroy index
          file:<codeblock>/root/cg-hlm/dev-tools/dpkg-scanpackages --multiversion . /dev/null | gzip -9c &gt; Packages.gz</codeblock></li>
      </ol>
    </section>

  <section id="next-step"> <title>Next Step</title>
      <p><xref href="carrier-grade-install-non-kvm.dita#topic10581">Installing the Non-KVM Region</xref></p>
</section>
</body>
</topic>

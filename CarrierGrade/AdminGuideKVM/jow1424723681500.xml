<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic id="jow1424723681500" xml:lang="en-us">
<!-- Modification History
        
-->
    <title>Specifying a Page Size for a VM </title>
    <shortdesc>You can request a specific memory page size for a VM by using a
        flavor with the required extra spec, or by defining an image with the required metadata
        property.</shortdesc>
    <prolog><author/>
        <author/>
        <author/>
    </prolog>
    <body>
        
            <p>Memory requested by a guest is allocated as one or more pages of a
                specified size. Once allocated, the memory is unavailable for use by other guests
                until the instance is terminated. </p>
            <p>To add this extra spec to a flavor using the web administration
                interface, use the <b>Memory Page Size</b> selection
                in the <b>Create Flavor Extra Spec</b> drop-down
                menu. To access this menu, see <xref href="jow1429538642910.xml"/>.</p>
            <p>You can also specify the extra spec from the CLI by setting the
                following parameter for a flavor:</p>
            <codeblock>hw:mem_page_size=<varname>pagesize</varname></codeblock>
            <p>where <varname>pagesize</varname> is one of the
                following:</p>
            <dl>
                <dlentry>
                    <dt>small</dt>
                    <dd>
                        <p>Requests the smallest available size on the compute node,
                            which is always 4KiB of regular memory. </p>
                    </dd>
                </dlentry>
                <dlentry>
                    <dt>large</dt>
                    <dd>
                        <p>Requests the largest available huge page size, 1GiB or
                            2MiB.</p>
                    </dd>
                </dlentry>
                <dlentry>
                    <dt>any</dt>
                    <dd>
                        <p>Requests any available size, including small pages.
                            HP Helion OpenStack Carrier Grade uses the largest available size, 1GiB, then 2MiB, and
                            then 4KiB.</p>
                    </dd>
                </dlentry>
                <dlentry>
                    <dt>2048</dt>
                    <dd>
                        <p>Requests a huge page of size 2 MiB. This is the default
                            value when the extra spec is not used.</p>
                    </dd>
                </dlentry>
                 <dlentry>
                    <dt>1048576</dt>
                    <dd>
                        <p>requests a huge page of size 1GiB.</p>
                    </dd>
                </dlentry> 
            </dl>
            <p>If any other value is supplied, it is ignored and the default value
                of <codeph>2048</codeph> is used.</p>
            <p>It is suggested that NFV applications use explicit huge page sizes to
                ensure predictable memory access at run time. Use of <codeph>large</codeph> and <codeph>any</codeph> sizes
                may cause VM migration issues when the available page size on the destination node
                is different. </p>
            <p>For example, to set a 1 GiB huge page size on a flavor that has
                already been created, use the following command:</p>
            <codeblock>~(keystone)admin)$ nova flavor-key <varname>flavor_name</varname> set hw:mem_page_size=1048576</codeblock>
            <p>You can also define an image with the required property by including
                the <parmname>hw_mem_page_size</parmname> parameter, as in the
                following example:</p>
            <codeblock>~(keystone)admin)$ nova image-meta <varname>image</varname> set hw_mem_page_size=<varname>pagesize</varname></codeblock>
            <p>Note that if you use image metadata to request a page size, the image
                is unable to access a <codeph>large</codeph> page unless
                the setting for the flavor is <codeph>large</codeph> or
                    <codeph>any</codeph>.</p>
        
        
            <p>Host memory on compute nodes reserved for use by VMs is partitioned
                by default using only 2 MiB huge page blocks. These blocks are used by default as
                the backing mechanism for VM virtual memory allocation requests. See <xref href="jow1423087781001.xml"/> for details on how to modify the
                memory partitioning scheme for a host.</p>
        
    </body>
</topic>
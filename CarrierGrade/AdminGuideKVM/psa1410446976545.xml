<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic ditaarch:DITAArchVersion="1.2" domains="(topic task topic)                            (topic hi-d)                            (topic pr-d)                            (topic sw-d)                            (topic ui-d)                            (topic wr-sw-d)                            (topic xml-d)   " id="psa1410446976545">
<!-- Modification History
        
-->
    <title>Installing Patches</title>
    <shortdesc><draft-comment author="rstone">US62817 changed wrs-patch -&gt;
            sw-patch</draft-comment>After adding a patch to the patch storage area, you must move it
        to the software updates repository, which manages patch distribution for the cluster. From
        there, you can install patches to the hosts that require them. </shortdesc>
    <prolog>
        <author>Jim Owens</author>
        <author></author>
    </prolog>
    <body>
        
            <p>Before you can install a patch, you must make it <term>available</term> by adding it
                to the patch storage area. For more information, see <xref href="psa1410446807133.xml"/>.</p>
        
        
            <p>Some of the available patches may be required on controller hosts
                only, while others may be required on compute or storage hosts. When you
                    <term>apply</term> an available patch, it is added to the software updates
                repository, ready for installation on any host type that requires it.  You can then
                install all applicable patches to each host in turn.</p>
            <p>To keep track of patch installation, you can use the <cmdname>sw-patch query</cmdname> command.</p>
            <codeblock>~(keystone_admin)$ sudo sw-patch query ﻿       Patch ID             Patch State
=========================   ===========
TITANIUM_14.10_PATCH_0001   Available
TITANIUM_14.10_PATCH_0002   Available
TITANIUM_14.10_PATCH_0003   Available</codeblock>
            <p>This shows the <codeph>Patch State</codeph> for each of the
                patches in the patch storage area:</p>
            <dl>
                <dlentry>
                    <dt><i>Available</i></dt>
                    <dd>
                        <p>A patch in the <i>Available</i> state has been added to the patch storage
                            area, but has not yet been added to the software updates repository or
                            installed on the hosts.</p>
                    </dd>
                </dlentry>
                <dlentry>
                    <dt><i>Partial-Apply</i></dt>
                    <dd>
                        <p>A patch in the <i>Partial-Apply</i> state
                            has been added to the software updates repository using the <cmdname>sw-patch apply</cmdname> command, but has not been
                            installed on all hosts that require it. It may have been installed on
                            some but not others, or it may not have been installed on any hosts.</p>
                    </dd>
                </dlentry>
                <dlentry>
                    <dt><i>Applied</i></dt>
                    <dd>
                        <p>A patch in the <i>Applied</i> state has
                            been installed on all hosts that require it, using either the <cmdname>system host-patch-reboot</cmdname> command (for use
                            with a locked host) or the <cmdname>sw-patch
                                host-install</cmdname> command (for use with an unlocked host, for
                            example during controller configuration).</p>
                    </dd>
                </dlentry>
            </dl>
            <p>You can use the <cmdname>sw-patch
                    query-hosts</cmdname> command to see which hosts are fully patched (<codeph>Patch Current</codeph>). This also shows which hosts
                require reboot, either because they are not fully patched, or because they are fully
                patched but need restarting to make the patches take effect.</p>
            <codeblock>~(keystone_admin)$ sudo sw-patch query-hosts ﻿  Hostname      IP Address    Patch Current  Reboot Required
============  ==============  =============  ===============
compute-0     192.168.204.15       Yes             No
controller-0  192.168.204.3        No              Yes
controller-1  192.168.204.4        No              Yes</codeblock>
            <p>The following example illustrates the process of installing a single
                patch on the cluster. It assumes that the patch is in the <i>Available</i> state already, as described in <xref href="psa1410446807133.xml"/>, and that only the controller nodes must be patched.</p>
        
        <ol>
            <li conref="psa1410446807133.xml#psa1410446807133/cli-admin-login" id="step_N10084_N10081_N1001F_N10001">
            </li>
            
             
                <li>Verify that the patches are available using the command <cmdname>sw-patch query</cmdname>.
                
                    <codeblock>~(keystone_admin)$ sudo sw-patch query ﻿       Patch ID             Patch State
=========================   ===========
TITANIUM_14.10_PATCH_0001   Available
TITANIUM_14.10_PATCH_0002   Available
TITANIUM_14.10_PATCH_0003   Available</codeblock>
                
                </li>
             
                <li>Apply the patch.
                
                    <codeblock>~(keystone_admin)$ sudo sw-patch apply TITANIUM_14.10_PATCH_0001 TITANIUM_14.10_PATCH_0001 is now in the repo</codeblock>
                
                
                    <p>The patch is now in the <i>Partial-Apply</i>
                        state, ready for installation from the software updates repository on the
                        impacted hosts.</p>
                
                </li>
             
                <li>Apply all available patches in a single operation.
                
                    <codeblock>~(keystone_admin)$ sudo sw-patch apply --all TITANIUM_14.10_PATCH_0001 is now in the repo TITANIUM_14.10_PATCH_0002 is now in the repo TITANIUM_14.10_PATCH_0003 is now in the repo</codeblock>
                
                
                    <p>In this example there are three patches ready now for
                        installation from the software updates repository.</p>
                
                </li>
             
                <li>Query the patching status of all hosts in the cluster.
                
                    <p>You can query the patching status of all hosts at any time as
                        illustrated below. Note that the reported status is the accumulated result
                        of all applied and removed patches in the software updates repository, and
                        not just the status due to a particular patch.</p>
                
                
                    <codeblock>~(keystone_admin)$ sudo sw-patch query-hosts ﻿  Hostname      IP Address    Patch Current  Reboot Required
============  ==============  =============  ===============
compute-0     192.168.204.15       Yes             No
controller-0  192.168.204.3        No              Yes
controller-1  192.168.204.4        No              Yes</codeblock>
                
                
                    <p>For each host in the cluster, the following patch status
                        fields are displayed:</p>
                    <dl>
                        <dlentry>
                            <dt>Patch Current</dt>
                            <dd>
                                <p>Indicates whether there are patches pending for
                                    installation or removal on the host or not. If <i>Yes</i>, then all relevant patches in the
                                    software updates repository have been installed on, or removed
                                    from, the host already. If <i>No</i>, then there
                                    is at least one patch in either the <i>Partial-Apply</i> or <i>Partial-Remove</i>
                                    states that has not been applied to the host.</p>
                            </dd>
                        </dlentry>
                        <dlentry>
                            <dt>Reboot Required </dt>
                            <dd>
                                <p>Indicates whether the host has to be rebooted or
                                    not as a result of one or more patches that have been either
                                    applied or removed, or because it is not patch current.</p>
                            </dd>
                        </dlentry>
                    </dl>
                    <p>In this example, <codeph>compute-0</codeph> is up to date, no patches need to be installed
                        and no reboot is required. By contrast, the controllers are not patch
                        current, and therefore a reboot is required to install the patch.</p>
                </li>
            
             
                <li>Install all pending patches on <codeph>controller-0</codeph>.
                 <ol>
                    
                        <li>Swact controller services.
                        
                            <codeblock>~(keystone_admin)$ system host-swact controller-0</codeblock>
                        
                        
                            <p>Before patching a controller node, you must transfer
                                any active services running on the host to the other controller.
                                Only then it is safe to lock the host.</p>
                        
                </li>
                    
                        <li>Run the patching sequence.
                        
                            <p>The patching sequence locks the host, installs the
                                patches, and forces a host reboot.</p>
                        
                        
                            <codeblock>~(keystone_admin)$ system host-patch-reboot controller-0 host-patch-reboot controller-0 may take several minutes to complete.
 
2014-10-17-20-39-59_host-patch-reboot start.
...
 
2014-10-17-20-39-59_host-patch-reboot host-lock.
waiting for host controller-0 to transition to locked-disabled-online ...
waiting for host controller-0 to transition to locked-disabled-online ...
2014-10-17-20-40-14_Host controller-0 is locked-disabled-online.
 
2014-10-17-20-40-14_Patch install request
Installing patch for host controller-0 ...
 
2014-10-17-20-40-16_Patch install response
Patch response Info: Patch installation was successful on controller-0.
 
2014-10-17-20-40-16_host-patch-reboot host-unlock
Restoring initial administrative state: unlocked. Unlocking host controller-0 to return to initial administrative state.</codeblock>
                        </li>
                    
                </ol>
                
                    <p>All patches are now installed on <codeph>controller-0</codeph>. Querying the current patch
                        status displays the following information:</p>
                    <codeblock>~(keystone_admin)$ sudo sw-patch query-hosts ﻿  Hostname      IP Address    Patch Current  Reboot Required
============  ==============  =============  ===============
compute-0     192.168.204.15       Yes             No
controller-0  192.168.204.3        Yes             No
controller-1  192.168.204.4        No              Yes</codeblock>
                
                </li>
             
                <li>Manually install all pending patches on <codeph>controller-0</codeph>.
                
                    <p>You may want to have finer control of the patching steps
                        executed by the <cmdname>system host-patch-reboot</cmdname>
                        command to determine when to install the patches and unlock the host.</p>
                
                 <ol>
                    
                        <li>Swact controller services.
                        
                            <codeblock>~(keystone_admin)$ system host-swact controller-0</codeblock>
                
                        
                            <p>Before patching a controller node, you must transfer
                                any active services running on the host to the other controller.
                                Only then it is safe to lock the host.</p>
                        
                        </li>    
                    
                        <li>Lock the host.
                        
                            <codeblock>~(keystone_admin)$ system host-lock controller-0</codeblock>
                        
                        
                            <p>You must lock the target host, controller, compute,
                                or storage, before installing patches.</p>
                        
                        </li>
                    
                        <li>Install the pending patches.
                        
                            <codeblock>~(keystone_admin)$ sudo sw-patch host-install controller-0 Patch installation was successful on controller-0</codeblock>
                        
                        
                            <p>All patches are now installed on <codeph>controller-0</codeph>. Querying the
                                current patching status displays the following information:</p>
                            <codeblock>~(keystone_admin)$ sudo sw-patch query-hosts ﻿  Hostname      IP Address    Patch Current  Reboot Required
============  ==============  =============  ===============
compute-0     192.168.204.15       Yes             No
controller-0  192.168.204.3        Yes             Yes
controller-1  192.168.204.4        No              Yes</codeblock>
                            <p>For illustration purposes in this section, the
                                command <cmdname>sw-patch host-install</cmdname> is
                                presented as the tool to <i>install</i> patches.
                                But in fact, this command also <i>removes</i>
                                patches as well, as described in <xref href="psa1410446902796.xml"/>. The command is better described then as the
                                tool to install and remove all patches in the <i>Partial-Apply</i> and <i>Partial-Remove</i>
                                states on a host.</p>
                        
                        </li>
                    
                        <li>Unlock the target host.
                        
                            <codeblock>~(keystone_admin)$ system host-unlock controller-0</codeblock>
                        
                        
                            <p>Unlocking the host forces a reset of the host
                                followed by a reboot. This ensures that the host is restarted in a
                                known state.</p>
                        
                        </li>
                </ol>
                
                    <p>All patches are now installed on <codeph>controller-0</codeph>.</p>
                
                </li>
             
                <li>Install all pending patches on <codeph>controller-1</codeph>.
                
                    <p>Repeat the previous step targeting <codeph>controller-1</codeph>
                        this time.</p>
                
                
                    <p>All patches are now installed on <codeph>controller-1</codeph> as well. Querying the
                        current patching status displays the following information:</p>
                    <codeblock>~(keystone_admin)$ sudo sw-patch query-hosts ﻿  Hostname      IP Address    Patch Current  Reboot Required
============  ==============  =============  ===============
compute-0     192.168.204.15       Yes             No
controller-0  192.168.204.3        Yes             No
controller-1  192.168.204.4        Yes             No</codeblock>
                
                </li>
             
                <li>Install any pending patches for the compute or storage
                    hosts.
                
                    <p>If the <codeph>Patch
                            Current</codeph> status for a compute or storage host is
                            <codeph>No</codeph>, apply the pending
                        patches using the following command:</p>
                    <codeblock>~(keystone_admin)$ system host-patch-reboot hostname</codeblock>
                    <p>where hostname is the
                        name of the host (for example, <codeph>compute-0</codeph>). This applies the patch and then reboots the
                        host.</p>
                
                </li>
             
                <li>Confirm that all patches are installed and the HP Helion OpenStack Carrier Grade
                    cluster is up-to-date.
                
                    <p>Use the <cmdname>sw-patch query</cmdname>
                        command to verify that all patches are <codeph>Applied</codeph>.</p>
                    <codeblock>~(keystone_admin)$ sudo sw-patch query ﻿       Patch ID             Patch State
=========================   ===========
TITANIUM_14.10_PATCH_0001   Applied</codeblock>
                    <p>If the <codeph>Patch
                            State</codeph> for any patch is still shown as <codeph>Available</codeph> or <codeph>Partial-Apply</codeph>, use the <codeph>sw-patch query-hosts</codeph> command to identify
                        which hosts are not <codeph>Patch
                            Current</codeph>, and then apply patches to them as described in
                        the preceding steps.</p>
                </li>
            
        </ol>
        
            <p>The Titanium cluster is up to date now. All patches are
                installed.</p>
        
    </body>
</topic>
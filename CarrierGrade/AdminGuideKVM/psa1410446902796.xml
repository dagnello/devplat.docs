<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic domains="(topic task topic)                            (topic hi-d)                            (topic pr-d)                            (topic sw-d)                            (topic ui-d)                            (topic wr-sw-d)                            (topic xml-d)   " id="psa1410446902796">
    <!-- Modification History
        
-->
    <title>Removing Patches</title>
    <shortdesc><draft-comment author="rstone">US62817 changed wrs-patch -&gt;
            sw-patch</draft-comment>Patches in the <i>Applied</i> or <i>Partial-Apply</i> states can be removed if necessary, for example, when
        they trigger undesired or unplanned effects on the Titanium cluster.</shortdesc>
    <prolog>
        <author></author>
    </prolog>
    <body>
        
            <p>Rolling back patches is conceptually identical to installing patches.
                A roll-back operation can be commanded for a patch in either the <i>Applied</i> or the <i>Partial-Apply</i> states. As the patch is
                removed, it goes through the following state transitions:</p>
            <dl>
                <dlentry>
                    <dt><i>Applied</i> or <i>Partial-Apply</i> to <i>Partial-Remove</i></dt>
                    <dd>
                        <p>A patch in the <i>Partial-Remove</i>
                            state indicates that it has been removed from zero or more, but not from
                            all, the applicable hosts.</p>
                        <p>Use the command <cmdname>sw-patch
                                remove</cmdname> to trigger this transition.</p>
                    </dd>
                </dlentry>
                <dlentry>
                    <dt><i>Partial-Remove</i> to <i>Available</i></dt>
                    <dd>
                        <p>Use the command <cmdname>sw-patch
                                host-install</cmdname> repeatedly targeting each time one of the
                            applicable hosts in the cluster. The transition to the <i>Available</i> state is complete when the patch is
                            removed from all target hosts. The patch remains in the patch storage
                            area as if it had just been uploaded.</p>
                    </dd>
                </dlentry>
            </dl>
            <p>The following example is basically a copy of the workflow used in
                    <xref href="psa1410446976545.xml"/>, but this time removing
                instead of installing the patch. The steps are therefore presented in simplified
                form.</p>
        
        <ol>
             
                <li>Log in as Keystone user <codeph>admin</codeph> to the active controller.</li>
            
             
                <li>Verify the state of the patch.</li>
                
                    <codeblock>~(keystone_admin)$ sudo sw-patch query</codeph>
<codeph>﻿       Patch ID             Patch State
=========================   ===========
TITANIUM_14.10_PATCH_0001   Applied</codeblock>
                    <p>In this example the patch is listed in the <i>Applied</i> state, but it could
                        be in the <i>Partial-Apply</i> state as well.</p>
                
            
             
                <li>Remove the patch.</li>
                
                    <codeblock>~(keystone_admin)$ sudo sw-patch remove TITANIUM_14.10_PATCH_0001</codeph>
<codeph>TITANIUM_14.10_PATCH_0001 has been removed from the repo</codeblock>
                
                
                    <p>The patch is now in the <i>Partial-Remove</i>
                        state, ready to be removed from the impacted hosts where it was already
                        installed.</p>
                
            
             
                <li>Query the patching status of all hosts in the cluster.</li>
                
                    <codeblock>~(keystone_admin)$ sudo sw-patch query-hosts</codeph>
<codeph>﻿  Hostname      IP Address    Patch Current  Reboot Required
============  ==============  =============  ===============
compute-0     192.168.204.15       Yes             No
controller-0  192.168.204.3        No              Yes
controller-1  192.168.204.4        No              Yes</codeblock>
                    <p>In this example, the controllers have patches ready to be
                        removed, and therefore must be rebooted.</p>
                
            
             
                <li>Remove all pending-for-removal patches from <codeph>controller-0</codeph>.</li>
                 <ol>
                    
                        <li>Swact controller services.</li>
                    
                    
                        <li>Run the patching sequence.</li>
                        
                            <codeblock>~(keystone_admin)$ system host-patch-reboot controller-0</codeblock>
                        
                    
                </ol>
            
             
                <li>Remove all pending patches from <codeph>controller-1</codeph>.</li>
            
        </ol>
        Host
            <p>The Titanium cluster is up to date now. All patches have been
                removed, and the patch TITANIUM_14.10_PATCH_0001 can be deleted from the patch
                storage area if necessary.</p>
            <p>It is important to note the role of the command <cmdname>wrs-path
                    host-install</cmdname> as a tool that both installs and removes patches as
                necessary.</p>
        
    </body>
</topic>
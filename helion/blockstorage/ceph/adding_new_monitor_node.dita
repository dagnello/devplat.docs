<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_zbc_pg4_rt">
  <title>HPE Helion <tm tmtype="reg">OpenStack</tm> 2.0: Adding a New Ceph Monitor Node</title>
  <body>
    <p>In HPE Helion OpenStack 2.0, a Ceph monitor node is installed on the Controller nodes by
      default. A new monitor node cannot be added to an existing Ceph cluster, if Ceph is deployed
      with the default configuration. However, if monitor nodes are added on a dedicated resource
      node, then you can add a new monitor node.</p>
    <p>If a monitor resource is not already defined, you will need to first define one and then add
      the new monitor node. For instructions, see <xref
        href="defining_monitor_resource.dita#topic_owr_kf4_rt"/>.</p>
    <p><b>To Add a New Monitor Node</b></p>
    <p>Perform the following procedure to add a new monitor node to an existing Ceph cluster:<ol
        id="ol_zsj_134_rt">
        <li>Login to the lifecycle manager.</li>
        <li>Edit the <codeph>~/helion/my_cloud/definition/data/servers.yml</codeph> file to define a
          new monitor node as shown
            below:<codeblock>- id: mon4
  ip-addr: 192.168.10.11
  role: MON-ROLE
  server-group: RACK3
  nic-mapping: MY-2PORT-SERVER
  mac-addr: 8b:f6:9e:ca:3b:7a
  ilo-ip: 192.168.9.11
  ilo-password: password
  ilo-user: admin</codeblock><note>Substitute
            the values in above sample as per your environment for the server being
          added.</note></li>
        <li>Commit your configuration:
            <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "Added monitor node {node-id}"</codeblock><note>Replace
            the <codeph>{node-id}</codeph> in the commit message with appropriate value (for
            example, <b>mon4</b>).</note></li>
        <li>Run the following
          command:<codeblock>cd ~/helion/hos/ansible/
ansible-playbook -i hosts/localhost cobbler-deploy.yml</codeblock></li>
        <li>To reimage all the nodes using PXE, run the following
          command:<codeblock>ansible-playbook -i hosts/localhost bm-reimage.yml</codeblock></li>
        <li>Run the configuration
          processor:<codeblock>ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>Use the playbook below to create a deployment directory:
          <codeblock>ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>Run the following commands: <p>
            <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts guard-deployment.yml
ansible-playbook -i hosts/verb_hosts osconfig-run.yml
ansible-playbook -i hosts/verb_hosts site.yml</codeblock>
          </p></li>
      <li>If you want the new compute node to be included in the monitoring service checks, there
          is an additional playbook that must be run to ensure this happens:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts monasca-deploy.yml --tags active_ping_checks</codeblock></li>
      </ol></p>
    <p>The new monitor node is deployed in an existing Ceph cluster.</p>
    <p><b>To Verify the Newly-Added Monitor Node</b></p>
    <p>From the lifecycle manager, run the following
        command:<codeblock>ceph --cluster ceph -f json quorum_status</codeblock><note>If the Ceph
        cluster name is different than the default (i.e. ceph), you need to modify the above command
        accordingly.</note></p>
    <p>The newly-added monitor's host name appears in the <codeph>quorum_names</codeph> section of
      the output of above command.</p>
  </body>
</topic>
